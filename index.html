<!doctype html>
<html>
  <head>
    <title>Mental Rotation Replication Experiment</title>
    <script src="https://unpkg.com/jspsych@8.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
    <!-- plugin to preload the stimuli-->
    <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
    <!-- survey text plugin for collectin PID -->
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
    <!-- fullscreen plug in -->
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
    <link
      href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>

  <body></body>
  <script>
    /* initialize jsPsych */
    var jsPsych = initJsPsych({
      on_finish: function () {
        jsPsych.data.displayData();
      },
    });

    /* create timeline */
    var timeline = [];

    // TODO: preload stimuli

    // fullscreen mode
    timeline.push({
      type: jsPsychFullscreen,
      fullscreen_mode: true
    });

    /* TODO: welcome participants */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "Welcome to the experiment. Press any key to begin."
    };

    // add the welcome trial to the timeline variable
    timeline.push(welcome);

    // collect participant ID
    var participant_id_entry = {
      type: jsPsychSurveyText,
      // TODO: chose how we want to define PID
      questions: [{ prompt: "Please enter your participant ID (e.g. p1):", name: "participant_id" }],
      on_finish: function (data) {
        console.log(data.response)
        jsPsych.data.addProperties({
          participant: data.response.participant_id
        });
      }

    };
    timeline.push(participant_id_entry);

    /* TODO: instructions */
    var instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
      <p>On each trial, you will see two 3D shapes. The shape on the left will be your <strong>baseline shape</strong>. The shape on the right will be the <strong>target shape</strong>.</p>
      <p>If the two shapes are the same, press 'f'.</p>
      <p>If the two shapes are different, press 'j'.</p>
      <p>Press any key to begin.</p>
    `
    };

    // add instructions trial to the tl
    timeline.push(instructions);


    /* TODO: basic comprehension check survey */

    /* create stimulus list */
    // IDEA: each element in the array will be a dictionary so that we can concurrently store information about the correctness of the response
    // MAIN TO DO: How can we expand this systematically to encompass all stimuli?
    var test_stimuli = [];
    for (let i = 1; i < 49; i++) {
      for (let j = 0; j < 4; j++) {
        image = {
          image_name: `stimuli/${i}_${j*50}.jpg`,
          correct_response: "same",
          correct_response_key: "f",
        };
        imageR = {
          image_name: `stimuli/${i}_${j*50}_R.jpg`,
          correct_response: "different",
          correct_response_key: "j",
        };
        test_stimuli.push(image, imageR);
      }
    }

    // here's how we can construct a simple mental rotation trial
    // TO DO: what else do we need to add to the trial procedure? What other information should we store? How can we turn this into a complete experiment timeline?
    var trial = {
      type: jsPsychImageKeyboardResponse,
      prompt:
        "<p>Press f if the images are the same, j if the images are different.<\p>",
      choices: ["f", "j"],
      data: {
        correct_response: stimulus_item["correct_response"],
        correct_response_key: stimulus_item["correct_response_key"],
      },
      stimulus: stimulus_item["image_name"],
    };

    timeline.push(trial);

    /* TODO: thank you message */

    /* start the experiment */
    jsPsych.run(timeline);
  </script>
</html>
